<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Job Manager</title>
		<link
			rel="stylesheet"
			href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
			integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
			crossorigin="anonymous"
		/>
		<script src="https://kit.fontawesome.com/8c9f7b77e5.js" crossorigin="anonymous"></script>
		<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
	</head>
	<body>
		<div class="container-fluid">
			<h1 class="m-3 display-4">Edit Job Details</h1>

			<!-- <form class="m-4"> -->
			<div class="form-row">
				<div class="form-group col-10">
					<label>Job Title*</label>
					<input type="text" class="form-control" id="jobtitle" />
				</div>
				<div class="col">
					<label>Job Number</label>
					<input type="text" class="form-control" id="jobnumber" readonly />
				</div>
			</div>

			<div class="form-row">
				<div class="form-group col-10">
					<label>Client*</label>
					<input type="text" class="form-control" id="client" />
				</div>
				<div class="col">
					<label>Status</label>
					<select id="status" class="form-control">
						<option value="0">Pending</option>
						<option value="1">Active</option>
						<option value="2">Deleted</option>
					</select>
				</div>
			</div>

			<div class="form-row mt-4">
				<div class="form-group col-11">
					<label>Live/Prod URL</label>
					<div class="input-group">
						<input type="url" class="form-control" id="prodURL" />
						<button class="btn btn-outline-dark" id="btnProdURL">
							<i class="fa fa-external-link" aria-hidden="true"></i>
						</button>
					</div>
				</div>
			</div>
			<div class="form-row">
				<div class="form-group col-11">
					<label>QA/UAT URL</label>
					<div class="input-group">
						<input type="url" class="form-control" id="QAURL" />
						<button class="btn btn-outline-dark" id="btnQAURL">
							<i class="fa fa-external-link" aria-hidden="true"></i>
						</button>
					</div>
				</div>
			</div>
			<div class="form-row">
				<div class="form-group col-11">
					<label>Repo URL</label>
					<div class="input-group">
						<input type="url" class="form-control" id="repoURL" />
						<button class="btn btn-outline-dark" id="btnRepoURL">
							<i class="fa fa-external-link" aria-hidden="true"></i>
						</button>
					</div>
				</div>
			</div>

			<div class="mt-3 p-1">
				<small class="text-dark lighten-4">* indicates a required field</small>
				<button class="btn btn-success float-right mr-4 pr-4 pl-4" id="btnSave">Save</button>
			</div>
			<!-- </form> -->
		</div>
		<script>
			var APIEndPoint = 'https://test.purplecosmos.co.za/api/api.aspx';

			$('#btnSave').on('click', () => {
				let jobtitle = document.getElementById('jobtitle').value;
				let jobnumber = document.getElementById('jobnumber').value;
				let client = document.getElementById('client').value;
				let status = document.getElementById('status').value;
				let prodURL = document.getElementById('prodURL').value;
				let QAURL = document.getElementById('QAURL').value;
				let repoURL = document.getElementById('repoURL').value;
				let clientid = 0;
				
				if (jobnumber == '') {
					$.ajax({
						type: 'POST',
						crossDomain: true,
						url: APIEndPoint + '/GetNextJobNumber',

						contentType: 'application/json; charset=utf-8',
						success: function (data) {
							jobnumber = data.d;

							$.ajax({
								type: 'POST',
								crossDomain: true,
								url: APIEndPoint + '/ListClients',
								contentType: 'application/json; charset=utf-8',
								success: function (data) {
									data = data.d;

									data.forEach((element) => {
										if (element.Name == client) {
											clientid = element.Id;
										}
									});
									var JobDetails = {
										Id: 4,
										ClientId: clientid,
										JobNumber: jobnumber,
										Title: jobtitle,
										RepoUrl: repoURL,
										LiveUrl: prodURL,
										TestUrl: QAURL,
									};
									$.ajax({
										type: 'POST',
										crossDomain: true,
										url: APIEndPoint + '/SaveJob',
										data: JSON.stringify(JobDetails),
										contentType: 'application/json; charset=utf-8',
										success: function (data) {
											console.log(data.d);
										},
										error: function (jqXHR, msg, erro) {
											console.log(JSON.stringify(jqXHR));
										},
									});
								},
								error: function (jqXHR, msg, erro) {
									console.log(JSON.stringify(jqXHR));
								},
							});
						},
					});
				}
			});

			$('#btnProdURL').on('click', () => {
				let prodURL = document.getElementById('prodURL').value;
				window.location.href = prodURL;
			});
			$('#btnQAURL').on('click', () => {
				let QAURL = document.getElementById('QAURL').value;
				window.location.href = QAURL;
			});
			$('#btnRepoURL').on('click', () => {
				let repoURL = document.getElementById('repoURL').value;
				window.location.href = RepoURL;
			});
		</script>
	</body>
</html>
